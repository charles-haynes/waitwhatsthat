{{ $galleryCSS := resources.Get "gallery.css" | fingerprint }}
{{ $lozad := resources.Get "lozad.js" | minify | fingerprint }}
<link href="{{ $galleryCSS.RelPermalink }}" rel="stylesheet">
<script src="{{ $lozad.RelPermalink }}"></script>
{{- $galleryId := (printf "gallery-%v" .Ordinal) }}
<gallery id="{{ $galleryId }}">
  {{- range $original := .Page.Resources.ByType "image" }}
    {{- $thumbnail := ($original.Resize "x150 Lanczos") }}
    {{- $preview := $original.Fit "32x32 q85 jpeg"}}
    {{- $ar := div (add $thumbnail.Width 0.0) $thumbnail.Height }}
    {{- $sz := math.Round (mul $ar 150)}}
    <div style="Width:{{$sz}}px;flex-grow:{{$sz}}">
      {{- $ar = div (math.Round (mul (div 100 $ar) 10)) 10}}
      <i style="padding-bottom:{{$ar}}%"></i>
      <a href="{{ $original.RelPermalink }}">
        <img
          src="data:image/jpeg;base64,{{$preview.Content | base64Encode }}"
          class="lozad"
          data-src="{{$thumbnail.RelPermalink}}"
        >
      </a>
    </div>
  {{- end }}
</gallery>
<script type="text/javascript">
 const observer =  lozad('.lozad', {
    loaded: function(el) {el.classList.add('loaded')}
});
 observer.observe();
</script>
